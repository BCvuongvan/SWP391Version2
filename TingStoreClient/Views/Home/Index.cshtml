@model IEnumerable<Product>
@{
    ViewData["Title"] = "Home Page";
    Layout = "/Views/Shared/_HomePage.cshtml";
}
<!-- Discount part Start -->
<section id="discount_part">
    <div class="container discount">
        <div class="row">
            <div class="name_box" style="margin-top: 100px">
                <h2><strong class="name_box_title">KHUYẾN MÃI CHỈ CÓ TRÊN ONLINE</strong></h2>
            </div>
            <div class="discount_payonl">
                <div class="home_slider">
                    <a href=""><img src="https://cdn.tgdd.vn/2023/09/banner/1200x150-tgdd-1200x150-1.png"
                            alt="discount"></a>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Discount part End -->
<section id="product_part testimonial_part" class="main">
    <div class="container">
        <div class="row bg-light">
            <div class="header box-title_title">
                <h3><strong>Sắp xếp theo</strong></h3>
            </div>
            <select name="sortOrder" id="sortOrder"  onchange="location.href='?sortOrder='+this.value">
                @if(ViewBag.CurrentSortOrder == "asc")
                {
                    <option value="asc" selected="selected">Thấp - cao</option>
                    <option value="desc">Cao - thấp</option>
                } else if(ViewBag.CurrentSortOrder == "desc")
                {
                    <option value="desc">Cao - thấp</option>
                    <option value="asc">Thấp - cao</option>
                }else
                {
                    <option value="asc" selected="selected">Thấp - cao</option>
                    <option value="desc">Cao - thấp</option>
                }
            </select>
            <div class="clent">
                @foreach (var product in Model)
                {
                    var originalPrice = product.proPrice;
                    var discountProduct = product.discountPercents.Where(dc => dc.startDate <= DateTime.Now && dc.endDate >= DateTime.Now).FirstOrDefault();
                    var discountedPrice = originalPrice;
                    if (discountProduct != null)
                {
                    var discount = originalPrice * discountProduct.discountPercentage / 100;
                    discountedPrice -= discount;
                }
                    @if (product.proStatus == true)
                    {
                        <div class="col-md-3 col-sm-6 col-xs-6 wow card_box">
                            <div class="card item-product text-center">
                                <div class="image">
                                    <a asp-controller="Home" asp-action="ManagementProductDetail" asp-route-id=@product.proId>
                                        <img src="~/assets/Product_Images/@product.proImage"
                                            style="width: 200px; height: 200px;" alt="@product.proName">
                                    </a>
                                    <h4>@product.proName</h4>
                                </div>
                                <div class="price-c">
                                    <p class="price">
                                        @if(discountProduct != null){
                                            <s class="giacu">@String.Format("{0:0,0VND}", originalPrice).Replace(",", ".")</s>
                                            }
                                        <br><span class="giamoi">@String.Format("{0:0,0VND}", discountedPrice).Replace(",", ".")</span>
                                    </p>
                                </div>
                                <a href=""><button type="button" class="btn btn-danger">Thêm vào giỏ hàng</button></a>
                                <div class="star_rate">
                                    <span class="fa fa-star checked"></span>
                                    <span class="fa fa-star checked"></span>
                                    <span class="fa fa-star checked"></span>
                                    <span class="fa fa-star checked"></span>
                                    <span class="fa fa-star checked"></span>
                                </div>
                                @{
                                    var discountPrice = product.discountPercents.Where(dc => dc.startDate <= DateTime.Now && dc.endDate >= DateTime.Now && dc.isActive == true).FirstOrDefault();
                                    if(discountPrice != null){
                                    <div class="install-0-tag">
                                        <span> Giảm @discountPrice.discountPercentage % </span>
                                    </div>
                                    }
                                }
                            </div>
                        </div>
                    }
                }
            </div>
        </div>
    </div>
</section>